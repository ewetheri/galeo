<div class="sheet-galeo">
	<div class="licensecontainer compendium-drop-target">
		<input class="sheet-toggle-npc" name="attr_npc" type="hidden" value="0">
		<!-- TODO Change rolls mada faka -->
		<div class="sheet-section-roll">
			<input type="hidden" name="attr_rtype" class="sheet-roll-toggle">
			<div class="sheet-section-roll-probable">
				<label class="sheet-radio">
					<input type="radio" name="attr_checkDice" value="3d10kh2">
					<span title="@{advantagetoggle}">Probable</span>
				</label>
				<label class="sheet-radio">
					<input type="radio" name="attr_checkDice" value="2d10" checked="checked">
					<span title="@{advantagetoggle}">Normal</span>
				</label>
				<label class="sheet-radio">
					<input type="radio" name="attr_checkDice" value="3d10kl2">
					<span title="@{advantagetoggle}">Improbable</span>
				</label>
			</div>
			<input type="hidden" name="attr_wtype" class="sheet-roll-toggle">
			<div class="sheet-section-roll-whisper">
				<label class="sheet-radio">
					<input type="radio" name="attr_whispertoggle" value="" checked="checked">
					<span title="@{whispertoggle}">Public</span>
				</label>
				<label class="sheet-radio">
					<input type="radio" name="attr_whispertoggle" value="/w gm ">
					<span title="@{whispertoggle}">To GM</span>
				</label>
			</div>
		</div>
		<div class="sheet-section-npc">
		</div>
		<div class="sheet-section-pc">
			<div class="sheet-section-pc-header">
				<div class="sheet-section-pc-header-logo">
					<div></div>
				</div>
				<div class="sheet-section-pc-header-name">
					<input type="text" name="attr_characterName" title="@{characterName}">
				</div>
				<div class="sheet-section-pc-header-details">
					<div class="sheet-form">
						<div class="sheet-form-header">Character Details</div>
						<div class="sheet-form-body">
							<div class="sheet-form-group">
								<label>Class:</label>
								<input type="text" name="attr_characterClass" title="@{characterClass}">
								<label>Level:</label>
								<input type="number" name="attr_level" value="1">
							</div>
							<div class="sheet-form-group">
								<label>Kine:</label>
								<input type="text" name="attr_kine">
								<label>Height:</label>
								<input type="text" name="attr_height" value="2 m">
								<label>Weight:</label>
								<input type="text" name="attr_weight" value="70 kg">
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="sheet-section-pc-body">
				<div class="sheet-tabs">
					<div class="sheet-tab sheet-tab-core">
						<input type="radio" name="attr_tab" value="core" checked="checked">
						<span class="sheet-tab-label">Core</span>
						<div class="sheet-tab-content">
						
						
							<!--
							#############
							CORE TAB
							PRIMARY STATS
							#############
							-->
							<div class="sheet-container-well sheet-pc-primaries">
								<div class="sheet-pc-header">
									<span>Primary Stats</span>
								</div>
								<div class="sheet-pc-primary">
									<div class="sheet-container-header">
										<button type="roll" name="roll_vigor" value="@{whispertoggle}&{template:stat} {{charactername=@{characterName}}} {{rollname=Vigor}} {{stat=@{vigor}}}">Vigor</button>
									</div>
									<div class="sheet-container-body">
										<input type="text" name="attr_vigor" title="@{vigor}" value="-1">
									</div>
								</div>
								<div class="sheet-pc-primary">
									<div class="sheet-container-header">
										<button type="roll" name="roll_intellect" value="@{whispertoggle}&{template:stat} {{charactername=@{characterName}}} {{rollname=Intellect}} {{stat=@{intellect}}}">Intellect</button>
									</div>
									<div class="sheet-container-body">
										<input type="text" name="attr_intellect" title="@{intellect}" value="-1">
									</div>
								</div>
								<div class="sheet-pc-primary">
									<div class="sheet-container-header">
										<button type="roll" name="roll_prowess" value="@{whispertoggle}&{template:stat} {{charactername=@{characterName}}} {{rollname=Prowess}} {{stat=@{prowess}}}">Prowess</button>
									</div>
									<div class="sheet-container-body">
										<input type="text" name="attr_prowess" title="@{prowess}" value="-1">
									</div>
								</div>
								<div class="sheet-pc-primary">
									<div class="sheet-container-header">
										<button type="roll" name="roll_spirit" value="@{whispertoggle}&{template:stat} {{charactername=@{characterName}}} {{rollname=Spirit}} {{stat=@{spirit}}}">Spirit</button>
									</div>
									<div class="sheet-container-body">
										<input type="text" name="attr_spirit" title="@{spirit}" value="-1">
									</div>
								</div>
							</div>
							
							
							<!--
							###############
							CORE TAB
							SECONDARY STATS
							###############
							-->
							<div class="sheet-container-well sheet-pc-secondaries">
								<div class="sheet-pc-header">
									<span>Secondary Stats</span>
								</div>
								<div class="sheet-pc-character-health">
									<div class="sheet-container-header">
										<button type="roll" name="roll_health" value="@{whispertoggle}&{template:doublestat} {{charactername=@{characterName}}} {{rollname=Health}} {{stat1=@{health}}} {{stat2=@{health_max}}}">Health:</button>
									</div>
									<div class="sheet-container-body">
										<div>
											<input type="text" name="attr_health" title="@{health}" value="20">
										</div>
										<div class="sheet-stylized-slash"></div>
										<div>
											<span name="attr_health_max" title="@{health_max}">20</span>
										</div>
									</div>
								</div>
								<div class="sheet-container-body sheet-pc-character-take-damage">
									<div>
										<input type="text" name="attr_takeCharacterDamageAmount" title="@{takeCharacterDamageAmount}" value="0">
									</div>
									<div>
										<select name="attr_takeCharacterDamageType" title="@{takeCharacterDamageType}">
											<option value="--" selected="selected">--</option>
											<option value="strike">strike</option>
											<option value="pierce">pierce</option>
											<option value="force">force</option>
											<option value="heat">heat</option>
											<option value="cold">cold</option>
											<option value="caustic">caustic</option>
											<option value="hex">hex</option>
											<option value="absolute">absolute</option>
											<option value="healing">healing</option>
										</select>
									</div>
									<div class="sheet-container-header">
										<button type="action" name="act_takeCharacterDamage">Take Damage</button>
									</div>
								</div>
								<div class="sheet-pc-character-encumbrance">
									<div class="sheet-container-header">
										<button type="roll" name="roll_encumbrance" value="@{whispertoggle}&{template:doublestat} {{charactername=@{characterName}}} {{rollname=Encumbrance}} {{stat1=@{encumbrance}}} {{stat2=@{encumbrance_max}}}">Weight:</button>
									</div>
									<div class="sheet-container-body">
										<div>
											<span name="attr_encumbrance" title="@{encumbrance}">0</span>
										</div>
										<div class="sheet-stylized-slash"></div>
										<div>
											<span name="attr_encumbrance_max" title="@{encumbrance_max}">50</span>
										</div>
									</div>
								</div>
								<div class="sheet-pc-character-speed">
									<div class="sheet-container-header">
										<button type="roll" name="roll_characterSpeed" value="@{whispertoggle}&{template:stat} {{charactername=@{characterName}}} {{rollname=Speed}} {{stat=@{characterSpeed}}}">Speed:</button>
									</div>
									<div class="sheet-container-body">
										<span name="attr_characterSpeed" title="@{characterSpeed}">0</span>m
									</div>
								</div>
								<div class="sheet-pc-character-dodge">
									<div class="sheet-container-header">
										<button type="roll" name="roll_dodge" value="@{whispertoggle}&{template:stat} {{charactername=@{characterName}}} {{rollname=Dodge}} {{stat=@{dodge}}}">Dodge:</button>
									</div>
									<div class="sheet-container-body">
										<span name="attr_dodge" title="@{dodge}">9</span>
									</div>
								</div>
							</div>
							
							
							<!--
							############
							CORE TAB
							GUNDYR STATS
							############
							-->
							<div class="sheet-container-well sheet-pc-gundyr">
								<div class="sheet-pc-gundyr-defense">
									<div></div>
									<div class="sheet-container-body">
										<input type="text" name="attr_defense" title="@{defense}" value="10">
									</div>
									<div class="sheet-container-header">
										<button type="roll" name="roll_defense" value="@{whispertoggle}&{template:stat} {{charactername=@{characterName}}} {{rollname=Defense}} {{stat=@{defense}}}">Defense</button>
									</div>
								</div>
								<div class="sheet-pc-gundyr-energy">
									<div></div>
									<div class="sheet-container-body">
										<span name="attr_energy" title="@{energy}">10</span>
									</div>
									<div class="sheet-container-header">
										<button type="roll" name="roll_energy" value="@{whispertoggle}&{template:stat} {{charactername=@{characterName}}} {{rollname=Energy}} {{stat=@{energy}}}">Energy</button>
									</div>
								</div>
								<div class="sheet-pc-gundyr-speed">
									<div></div>
									<div class="sheet-container-body">
										<input type="text" name="attr_gundyrSpeed" title="@{gundyrSpeed}" value="10">
									</div>
									<div class="sheet-container-header">
										<button type="roll" name="roll_gundyrSpeed" value="@{whispertoggle}&{template:stat} {{charactername=@{characterName}}} {{rollname=Speed}} {{stat=@{gundyrSpeed}}}">Speed</button>
									</div>
								</div>
								<div class="sheet-pc-gundyr-durability">
									<div></div>
									<div></div>
									<div></div>
									<div></div>
									<div class="sheet-container-body">
										<input type="text" name="attr_durability" title="@{durability}" value="10">
									</div>
									<div class="sheet-container-body">
										<input class="sheet-pc-gundyr-durability-max-input" type="text" name="attr_durability_max" title="@{durability_max}" value="10">
									</div>
									<div></div>
									<div class="sheet-container-header">
										<button type="roll" name="roll_durability" value="@{whispertoggle}&{template:doublestat} {{charactername=@{characterName}}} {{rollname=Durability}} {{stat1=@{durability}}} {{stat2=@{durability_max}}}">Durability</button>
									</div>
								</div>
								<div class="sheet-pc-gundyr-runes">
									<div></div>
									<div></div>
									<div class="sheet-container-body">
										<input type="text" name="attr_greaterRunes" title="@{greaterRunes}" value="0">
									</div>
									<div class="sheet-container-body">
										<input type="text" name="attr_lesserRunes" title="@{lesserRunes}" value="0">
									</div>
									<div class="sheet-container-header">
										<button type="roll" name="roll_greaterRunes" value="@{whispertoggle}&{template:stat} {{charactername=@{characterName}}} {{rollname=Greater Runes}} {{stat=@{greaterRunes}}}">Greater</button>
									</div>
									<div class="sheet-container-header">
										<button type="roll" name="roll_lesserRunes" value="@{whispertoggle}&{template:stat} {{charactername=@{characterName}}} {{rollname=Lesser Runes}} {{stat=@{lesserRunes}}}">Lesser</button>
									</div>
								</div>
								<div class="sheet-container-body sheet-pc-gundyr-take-damage">
									<div class="sheet-pc-gundyr-take-damage-amount">
										<input type="text" name="attr_takeGundyrDamageAmount" title="@{takeGundyrDamageAmount}" value="0">
									</div>
									<div class="sheet-pc-gundyr-take-damage-type">
										<select name="attr_takeGundyrDamageType" title="@{takeGundyrDamageType}">
											<option value="--" selected="selected">--</option>
											<option value="strike">strike</option>
											<option value="pierce">pierce</option>
											<option value="force">force</option>
											<option value="heat">heat</option>
											<option value="cold">cold</option>
											<option value="caustic">caustic</option>
											<option value="hex">hex</option>
											<option value="absolute">absolute</option>
											<option value="healing">healing</option>
										</select>
									</div>
									<div class="sheet-container-header">
										<button type="action" name="act_takeGundyrDamage">Take Damage</button>
									</div>
								</div>
								<div class="sheet-pc-gundyr-amplification">
									<div></div>
									<div class="sheet-container-body">
										<input type="text" name="attr_amplification" title="@{amplification}" value="0">
									</div>
									<div class="sheet-container-header">
										<button type="roll" name="roll_gundyrAmplification" value="@{whispertoggle}&{template:stat} {{charactername=@{characterName}}} {{rollname=Amplification}} {{stat=@{amplification}}}">Amplification</button>
									</div>
								</div>
							</div>
							
							
							<!--
							#############
							CORE TAB
							PROFICIENCIES
							#############
							-->
							<div class="sheet-container-well sheet-pc-proficiencies">
								<div class="sheet-pc-header">
									<span>Proficiencies</span>
								</div>
								<fieldset class="repeating_proficiency">
									<div class="sheet-fieldset-item">
										<div class="sheet-pc-proficiency">
											<div class="sheet-pc-proficiency-roll">
												<button type="roll" name="roll_check" value="@{whispertoggle}&{template:check} {{charactername=@{characterName}}} {{rollname=@{proficiencyName}}} {{roll=[[@{checkDice}+0+@{proficiencyMod}]]}}" class="sheet-button-d10"></button>
											</div>
											<div class="sheet-pc-proficiency-name">
												<input type="text" name="attr_proficiencyName" class="sheet-hidden" value="">
											</div>
											<div class="sheet-pc-proficiency-stat">
												<select name="attr_proficiencyStat" title="@{proficiencyStat}">
													<option value="--" selected="selected">--</option>
													<option value="vigor">VIG</option>
													<option value="intellect">INT</option>
													<option value="prowess">PRO</option>
													<option value="spirit">SPI</option>
												</select>
											</div>
											<div class="sheet-pc-proficiency-mod">
												<input type="number" name="attr_proficiencyMod" class="sheet-hidden" value="">
											</div>
										</div>
									</div>
								</fieldset>
									
							</div>
							
							
							<!--
							#########
							CORE TAB
							ABILITIES
							#########
							-->
							<div class="sheet-container-well sheet-pc-abilities">
							
							</div>
							
							
							<!--
							########
							CORE TAB
							STATUSES
							########
							-->
							<div class="sheet-container-well sheet-pc-statuses">
							
							</div>
						</div>
					</div>
					<div class="sheet-tab sheet-tab-character">
						<input type="radio" name="attr_tab" value="character">
						<span class="sheet-tab-label">Character</span>
						<div class="sheet-tab-content">
							<div class="sheet-container-well sheet-pc-primaries">
								<div class="sheet-pc-primary">
									<div class="sheet-container-header">
										<button type="roll" name="roll_vigor" value="@{wtype}&{template:simple} {{rname=Vigor}} {{mod=@{vigor}}} {{r1=[[@{d20}+@{vigor}[Vigor]]]}} @{rtype}+@{vigor}[Vigor]]]}} @{charname_output}">Vigor</button>
									</div>
									<div class="sheet-container-body">
										<input type="text" name="attr_vigor" title="@{vigor}" value="-1">
									</div>
								</div>
								<div class="sheet-pc-primary">
									<div class="sheet-container-header">
										<button type="roll" name="roll_intellect" value="@{wtype}&{template:simple} {{rname=Intellect}} {{mod=@{intellect}}} {{r1=[[@{d20}+@{intellect}[Intellect]]]}} @{rtype}+@{intellect}[Intellect]]]}} @{charname_output}">Intellect</button>
									</div>
									<div class="sheet-container-body">
										<input type="text" name="attr_intellect" title="@{intellect}" value="-1">
									</div>
								</div>
								<div class="sheet-pc-primary">
									<div class="sheet-container-header">
										<button type="roll" name="roll_prowess" value="@{wtype}&{template:simple} {{rname=Prowess}} {{mod=@{prowess}}} {{r1=[[@{d20}+@{prowess}[Prowess]]]}} @{rtype}+@{prowess}[Prowess]]]}} @{charname_output}">Prowess</button>
									</div>
									<div class="sheet-container-body">
										<input type="text" name="attr_prowess" title="@{prowess}" value="-1">
									</div>
								</div>
								<div class="sheet-pc-primary">
									<div class="sheet-container-header">
										<button type="roll" name="roll_spirit" value="@{wtype}&{template:simple} {{rname=Spirit}} {{mod=@{spirit}}} {{r1=[[@{d20}+@{spirit}[Spirit]]]}} @{rtype}+@{spirit}[Spirit]]]}} @{charname_output}">Spirit</button>
									</div>
									<div class="sheet-container-body">
										<input type="text" name="attr_spirit" title="@{spirit}" value="-1">
									</div>
								</div>
							</div>
							<div class="sheet-container-well sheet-pc-secondaries">
							</div>
							<div class="sheet-container-well sheet-pc-proficiencies">
							</div>
						</div>
					</div>
					<div class="sheet-tab sheet-tab-gundyr">
						<input type="radio" name="attr_tab" value="gundyr">
						<span class="sheet-tab-label">Gundyr</span>
						<div class="sheet-tab-content">
							<div class="sheet-container-well sheet-pc-gundyr">
								<div class="sheet-pc-gundyr-defense">
								</div>
								<div class="sheet-pc-gundyr-speed">
								</div>
								<div class="sheet-pc-gundyr-durability">
								</div>
								<div class="sheet-pc-gundyr-runes">
								</div>
								<div class="sheet-pc-gundyr-amplification">
								</div>
							</div>
						</div>
					</div>
					<div class="sheet-tab sheet-tab-options">
						<input type="radio" name="attr_tab" value="options">
						<span class="sheet-tab-label">Options</span>
						<div class="sheet-tab-content">
						
						</div>
					</div>
				</div>
			</div>
			<div class="sheet-section-pc-footer">
				<p>Galeo Character Sheet</p>
			</div>
		</div>
		<div class="sheet-section-fields">
			<!--CORE-->
			<input type="hidden" name="attr_checkDice" value="2d10">
			<input type="hidden" name="attr_checkDiceProbable" value="3d10kh2">
			<input type="hidden" name="attr_checkDiceImprobable" value="3d10kl2">
			<input type="hidden" name="attr_whisperToggle" value="">
			<input type="hidden" name="attr_characterName" value="">
			<input type="hidden" name="attr_level" value="1">
			<input type="hidden" name="attr_kine" value="">
			<input type="hidden" name="attr_height" value="0">
			<input type="hidden" name="attr_weight" value="0">
			
			<!--CHARACTER-->
			<input type="hidden" name="attr_healthMod" value="0">
			<input type="hidden" name="attr_encumbranceMod" value="0">
			<input type="hidden" name="attr_characterSpeedMod" value="0">
			<input type="hidden" name="attr_dodgeArmor" value="0">
			<input type="hidden" name="attr_dodgeMod" value="0">
			<input type="hidden" name="attr_characterResiststrike" value="0">
			<input type="hidden" name="attr_characterResistpierce" value="0">
			<input type="hidden" name="attr_characterResistforce" value="0">
			<input type="hidden" name="attr_characterResistheat" value="0">
			<input type="hidden" name="attr_characterResistcold" value="0">
			<input type="hidden" name="attr_characterResistcaustic" value="0">
			<input type="hidden" name="attr_characterResisthex" value="0">
			<input type="hidden" name="attr_characterResistabsolute" value="0">

			<!--GUNDYR-->
			<input type="hidden" name="attr_defenseBase" value="10">
			<input type="hidden" name="attr_defensePlating" value="0">
			<input type="hidden" name="attr_defenseMod" value="0">
			<input type="hidden" name="attr_energy" value="10">
			<input type="hidden" name="attr_energyBase" value="10">
			<input type="hidden" name="attr_energyMod" value="0">
			<input type="hidden" name="attr_defenseBase" value="0">
			
			<input type="hidden" name="attr_gundyrResiststrike" value="0">
			<input type="hidden" name="attr_gundyrResistpierce" value="0">
			<input type="hidden" name="attr_gundyrResistforce" value="0">
			<input type="hidden" name="attr_gundyrResistheat" value="0">
			<input type="hidden" name="attr_gundyrResistcold" value="0">
			<input type="hidden" name="attr_gundyrResistcaustic" value="0">
			<input type="hidden" name="attr_gundyrResisthex" value="0">
			<input type="hidden" name="attr_gundyrResistabsolute" value="0">
			
			<!--DISPLAY & OPTIONS-->
			<input type='hidden' name='attr_abstractHealth' value='1'>
			<input type='hidden' name='attr_abstractDurability' value='1'>
		</div>
		<div class="sheet-section-templates">
			<div class="sheet-rolltemplates">
				<rolltemplate class="sheet-rolltemplate-stat">
					<div class="sheet-template-stat-container">
						<div class="sheet-template-header">
							{{charactername}}'s {{rollname}}
						</div>
						<div class="sheet-template-body">
							{{stat}}
						</div>
					</div>
				</rolltemplate>
				
				<rolltemplate class="sheet-rolltemplate-doublestat">
					<div class="sheet-template-stat-container">
						<div class="sheet-template-header">
							{{charactername}}'s {{rollname}}
						</div>
						<div class="sheet-template-body">
							{{stat1}} / {{stat2}}
						</div>
					</div>
				</rolltemplate>
				
				<rolltemplate class="sheet-rolltemplate-check">
					<div class="sheet-template-stat-container">
						<div class="sheet-template-header">
							{{charactername}}'s {{rollname}} check
						</div>
						<div class="sheet-template-body">
							{{roll}}
						</div>
					</div>
				</rolltemplate>
			</div>
		</div>
		<script type="text/worker">
			// BUTTONS
			on(`clicked:takeCharacterDamage`, function() {
				getAttrs(["health", "health_max", "takeCharacterDamageAmount", "takeCharacterDamageType"], function(v) {
					var update = {};
					if (v["takeCharacterDamageType"] == "healing") {
						var healing = parseInt(v["takeCharacterDamageAmount"], 10);
						var currentHealth = parseInt(v["health"], 10) + healing;
						var maxHealth = parseInt(v["health_max"], 10)
						if (currentHealth > maxHealth) {
							currentHealth = maxHealth;
						}
						update["health"] = currentHealth;
						update["takeCharacterDamageAmount"] = 0;
						update["takeCharacterDamageType"] = "--";
						setAttrs(update);
					} else if (v["takeCharacterDamageType"] != "--") {
						getAttrs(["characterResist"+v["takeCharacterDamageType"]], function(v2) {
							var damage = parseInt(v["takeCharacterDamageAmount"], 10);
							var modifiedDamage = damage - parseInt(v2["characterResist"+v["takeCharacterDamageType"]] , 10);
							var currentHealth = parseInt(v["health"], 10) - modifiedDamage;
							update["health"] = currentHealth;
							update["takeCharacterDamageAmount"] = 0;
							update["takeCharacterDamageType"] = "--";
							setAttrs(update);
						});
					} else {
						update["takeCharacterDamageAmount"] = 0;
						update["takeCharacterDamageType"] = "--";
						setAttrs(update);
					}
				});
			});
			
			on(`clicked:takeGundyrDamage`, function() {
				getAttrs(["health", "durability", "durability_max", "takeGundyrDamageAmount", "takeGundyrDamageType"], function(v) {
					var update = {};
					if (v["takeGundyrDamageType"] == "healing") {
						var healing = parseInt(v["takeGundyrDamageAmount"], 10);
						var currentDurability = parseInt(v["durability"], 10) + healing;
						var maxDurability = parseInt(v["durability_max"], 10)
						if (currentDurability > maxDurability) {
							currentDurability = maxDurability;
						}
						update["durability"] = currentDurability;
						update["takeGundyrDamageAmount"] = 0;
						update["takeGundyrDamageType"] = "--";
						setAttrs(update);
					} else if (v["takeGundyrDamageType"] != "--") {
						getAttrs(["gundyrResist"+v["takeGundyrDamageType"]], function(v2) {
							var damage = parseInt(v["takeGundyrDamageAmount"], 10);
							var modifiedDamage = damage - parseInt(v2["gundyrResist"+v["takeGundyrDamageType"]] , 10);
							var currentDurability = parseInt(v["durability"], 10);
							if (currentDurability < modifiedDamage) {
								var leftoverDamage = modifiedDamage - currentDurability;
								update["health"] = parseInt(v["health"], 10) - leftoverDamage;
								update["durability"] = 0;
								update["takeGundyrDamageAmount"] = 0;
								update["takeGundyrDamageType"] = "--";
								setAttrs(update);
							} else {
								var afterDurability = currentDurability - modifiedDamage;
								update["durability"] = afterDurability;
								update["takeGundyrDamageAmount"] = 0;
								update["takeGundyrDamageType"] = "--";
								setAttrs(update);
							}
						});
					} else {
						update["takeGundyrDamageAmount"] = 0;
						update["takeGundyrDamageType"] = "--";
						setAttrs(update);
					}
				});
			});
			
			// STAT CHANGES
			on(`change:vigor`, function() {
				update_proficiencies(`vigor`);
				update_max_health();
				update_max_encumbrance();
			});
			
			on(`change:intellect`, function() {
				update_proficiencies(`intellect`);
			});
			
			on(`change:prowess`, function() {
				update_proficiencies(`prowess`);
				update_dodge();
			});
			
			on(`change:spirit`, function() {
				update_proficiencies(`spirit`);
				update_energy();
			});
			
			on(`change:health change:health_max change:healthMod`, function() {
				//TODO
			});
			
			on(`change:encumbrance change:encumbrance_max change:encumbranceMod change:characterSpeedMod`, function() {
				update_character_speed();
			});
			
			var update_proficiencies = function(primary) {
				var update = {};
				// TODO
			}
			
			var update_max_health = function() {
				var update = {};
				getAttrs(["vigor", "healthMod"], function(v) {
					var vigor = parseInt(v["vigor"]);
					var maxHealth = parseInt(v["healthMod"], 10) + 30 + (vigor * 10);
					update["health_max"] = maxHealth;
					setAttrs(update);
				});
			}
			
			var update_max_encumbrance = function() {
				var update = {};
				getAttrs(["vigor"], function(v) {
					var vigor = parseInt(v["vigor"]);
					var maxEncumbrance = 50 + (vigor * 10);
					update["encumbrance_max"] = maxEncumbrance;
					setAttrs(update);
				});
			}
			
			var update_character_speed = function() {
				var update = {};
				getAttrs(["encumbrance", "encumbrance_max", "encumbranceMod"], function(v) {
					var currentEncumbrance = parseInt(v["encumbrance"]);
					var maxEncumbrance = parseInt(v["encumbrance_max"]);
					var speed = ((maxEncumbrance - currentEncumbrance) / 2) + parseInt(v["encumbranceMod"]);
					update["characterSpeed"] = speed;
					setAttrs(update);
				});
			}
			
			var update_dodge = function() {
				var update = {};
				// TODO
			}
			
			var update_energy = function() {
				var update = {};
				// TODO
			}
			
		</script>
	</div>
</div>